{% extends 'core/base.html' %}

{% block title %}Wnioski{% endblock %}

{% block content %}
<h3 class="mb-3">Wnioski</h3>

{% if sesja and punkt %}
  <div class="card mb-3 shadow-sm">
    <div class="card-body">
      <div class="d-flex justify-content-between flex-wrap">
        <div>
          <div class="fw-semibold">{{ sesja.nazwa }}</div>
          <div class="text-muted small">Punkt: {{ punkt.numer }}. {{ punkt.tytul }}</div>
        </div>
        <span class="badge bg-success align-self-center">Sesja aktywna</span>
      </div>
    </div>
  </div>
{% else %}
  <div class="alert alert-info">
    Możesz składać wnioski również poza sesją. Jeśli nie ma aktywnego punktu obrad, wniosek zostanie zapisany jako „poza sesją”.
  </div>
{% endif %}

<div class="card mb-4 shadow-sm">
  <div class="card-header">
    {% if sesja and punkt %}
      Złóż wniosek do aktualnego punktu
    {% else %}
      Złóż wniosek (poza sesją)
    {% endif %}
  </div>
  <div class="card-body">
    <form method="post">
      {% csrf_token %}
      {{ form.as_p }}

      {% if mozna_przypiac %}
        <div class="form-check mt-2">
          <input class="form-check-input" type="checkbox" value="1" id="pozaSesja" name="poza_sesja">
          <label class="form-check-label" for="pozaSesja">
            Złóż poza sesją (nie przypinaj do aktualnego punktu)
          </label>
        </div>
      {% endif %}

      <button type="submit" class="btn btn-primary mt-3">Złóż wniosek</button>
    </form>
  </div>
</div>

<h5 class="mb-2">Twoje wnioski</h5>

{% if wnioski %}
  <div class="list-group shadow-sm">
    {% for w in wnioski %}
      <div class="list-group-item">
        <div class="d-flex justify-content-between flex-wrap gap-2">
          <div>
            <div class="fw-semibold">Sygnatura: {{ w.sygnatura }}</div>
            <div class="small text-muted">{{ w.data }}</div>
          </div>
          <div class="text-end">
            {% if w.zatwierdzony %}
              <span class="badge bg-success">Zatwierdzony</span>
            {% else %}
              <span class="badge bg-secondary">Oczekuje</span>
            {% endif %}
          </div>
        </div>

        <div class="mt-2">{{ w.tresc|linebreaksbr }}</div>

        {% if w.punkt_obrad %}
          <div class="small text-muted mt-2">
            Sesja: {{ w.punkt_obrad.sesja.nazwa }} • Punkt: {{ w.punkt_obrad.numer }}. {{ w.punkt_obrad.tytul }}
          </div>
        {% else %}
          <div class="small text-muted mt-2">
            Poza sesją
          </div>
        {% endif %}
      </div>
    {% endfor %}
  </div>
{% else %}
  <div class="alert alert-info">Nie złożyłeś jeszcze żadnych wniosków.</div>
{% endif %}

{% endblock %}
