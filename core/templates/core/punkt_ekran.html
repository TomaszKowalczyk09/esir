{% extends 'core/base.html' %}

{% block title %}Ekran punktu{% endblock %}

{% block content %}
<div class="text-center">
    <h1>{{ punkt.sesja.nazwa }}</h1>
    <h2 class="mt-4">Punkt {{ punkt.numer }} – {{ punkt.tytul }}</h2>
    {% if punkt.opis %}
    <p class="lead mt-3">{{ punkt.opis }}</p>
    {% endif %}

    {% if glosowanie %}
        <h3 class="mt-4">{{ glosowanie.nazwa }}</h3>
        <p>
            Status:
            {% if glosowanie.otwarte %}
                <span class="badge bg-success">Głosowanie otwarte</span>
            {% else %}
                <span class="badge bg-danger">Głosowanie zamknięte</span>
            {% endif %}
        </p>

        <div class="row justify-content-center mt-4">
            <div class="col-md-3">
                <div class="card border-success mb-3">
                    <div class="card-header bg-success text-white">ZA</div>
                    <div class="card-body">
                        <h1 class="display-4" id="za-count">
                            {% if wyniki %}{{ wyniki.za }}{% else %}0{% endif %}
                        </h1>
                    </div>
                </div>
            </div>
            <div class="col-md-3">
                <div class="card border-danger mb-3">
                    <div class="card-header bg-danger text-white">PRZECIW</div>
                    <div class="card-body">
                        <h1 class="display-4" id="przeciw-count">
                            {% if wyniki %}{{ wyniki.przeciw }}{% else %}0{% endif %}
                        </h1>
                    </div>
                </div>
            </div>
            <div class="col-md-3">
                <div class="card border-warning mb-3">
                    <div class="card-header bg-warning">WSTRZYMUJĘ SIĘ</div>
                    <div class="card-body">
                        <h1 class="display-4" id="wstrzymuje-count">
                            {% if wyniki %}{{ wyniki.wstrzymuje }}{% else %}0{% endif %}
                        </h1>
                    </div>
                </div>
            </div>
        </div>
    {% else %}
        <div class="alert alert-info mt-4">
            Dla tego punktu nie utworzono jeszcze głosowania.
        </div>
    {% endif %}
</div>
{% endblock %}

{% block extra_js %}
{% if glosowanie %}
<script>
setInterval(function () {
    $.get("{% url 'api_wyniki' glosowanie.id %}", function (data) {
        $('#za-count').text(data.za);
        $('#przeciw-count').text(data.przeciw);
        $('#wstrzymuje-count').text(data.wstrzymuje);
    });
}, 2000);
</script>
{% endif %}
{% endblock %}
